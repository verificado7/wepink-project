<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>wepink :: Pagamento</title>
  <meta name="description" content="Finalize sua compra na WePink com segurança e rapidez.">
  <meta name="copyright" content="WePink">
  <meta name="author" content="WePink">
  <meta name="country" content="BRA">
  <meta name="language" content="pt-BR">
  <link rel="icon" href="/img/we.png" type="image/png">
  <link rel="stylesheet" href="/styles.css">
  <script src="https://sdk.mercadopago.com/js/v2"></script>
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #fff;
    }
    header, footer, section { padding: 20px; }
    .header-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      background-color: #fff;
      position: relative;
    }
    .header-bar .logo-text {
      font-weight: bold;
      font-size: 1.5rem;
      color: #ff2e82;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }
    .header-icons { display: flex; gap: 10px; }
    .header-icons svg { width: 24px; height: 24px; stroke: #000; stroke-width: 2; }
    .header-icons a { text-decoration: none; }
    .menu-icon { background: none; border: none; cursor: pointer; }
    .menu-icon svg { width: 24px; height: 24px; stroke: #000; stroke-width: 2; }
    .payment-section { max-width: 1200px; margin: 0 auto; }
    .payment-section h2 { color: #ff2e82; font-size: 1.5rem; margin-bottom: 20px; }
    .order-summary { display: flex; gap: 40px; margin-bottom: 40px; }
    .order-items { flex: 1; }
    .order-items h3 { font-size: 1.2rem; margin-bottom: 20px; }
    .order-item { display: flex; gap: 20px; margin-bottom: 20px; }
    .order-item img { max-width: 100px; height: auto; border-radius: 8px; }
    .order-item-details { flex: 1; }
    .order-item-details h4 { font-size: 1.1rem; margin-bottom: 10px; }
    .order-item-details p { font-size: 1rem; color: #666; }
    .order-total { background: #f5f5f5; padding: 20px; border-radius: 8px; flex: 1; }
    .order-total h3 { font-size: 1.2rem; margin-bottom: 20px; }
    .order-total p { font-size: 1rem; margin: 10px 0; }
    .order-total .total { font-size: 1.5rem; font-weight: bold; color: #ff2e82; }
    .payment-methods { margin-bottom: 40px; }
    .payment-methods h3 { font-size: 1.2rem; margin-bottom: 20px; }
    #payment-bricks-container { margin-bottom: 20px; }
    .payment-status { text-align: center; }
    .payment-status h3 { font-size: 1.2rem; margin-bottom: 10px; }
    .payment-status p { font-size: 1rem; color: #666; }
    footer {
      background-color: #ff2e82;
      color: #fff;
      text-align: center;
      padding: 20px;
    }
    .social-links {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    .social-links a {
      background-color: #fff;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
    }
    .social-links img {
      width: 24px;
      height: 24px;
    }
    .payment-methods-footer {
      margin: 20px 0;
    }
    .payment-methods-footer h4 {
      font-size: 1rem;
      margin-bottom: 10px;
      text-transform: uppercase;
    }
    .payment-methods-footer img {
      margin: 0 5px;
      height: 30px;
    }
    .payment-methods-footer img.pix-icon {
      height: 40px;
    }
    .footer-info p {
      font-size: 0.8rem;
      margin: 5px 0;
    }
    .scroll-to-top {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 20px;
    }
    .scroll-to-top .circle {
      background-color: #ff99cc;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
    }
    .scroll-to-top svg {
      width: 16px;
      height: 16px;
      stroke: #fff;
      stroke-width: 2;
    }
    .scroll-to-top p {
      font-size: 0.8rem;
      margin: 0;
      color: #fff;
    }
    @media (max-width: 600px) {
      .order-summary { flex-direction: column; }
      .order-item img { max-width: 80px; }
      .order-total .total { font-size: 1.2rem; }
    }
  </style>
</head>
<body>
  <!-- Cabeçalho -->
  <div class="header-bar">
    <button class="menu-icon">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
    <div class="logo-text">wepink</div>
    <div class="header-icons">
      <a href="index.html">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
        </svg>
      </a>
    </div>
  </div>

  <!-- Seção de Pagamento -->
  <section class="payment-section">
    <h2>Finalizar Compra</h2>
    <div class="order-summary">
      <div class="order-items">
        <h3>Resumo do Pedido</h3>
        <div class="order-item">
          <img id="product-image" src="/img/onetouch.png" alt="Produto">
          <div class="order-item-details">
            <h4 id="product-name">One Touch Silk Desodorante Colônia 100ml - Wepink</h4>
            <p>Quantidade: 1</p>
            <p id="product-price">R$ 350,00</p>
          </div>
        </div>
      </div>
      <div class="order-total">
        <h3>Total</h3>
        <p>Subtotal: <span id="subtotal">R$ 350,00</span></p>
        <p>Frete: <span id="shipping-cost">R$ 3,00</span></p>
        <p class="total" id="total">R$ 353,00</p>
      </div>
    </div>
    <div class="payment-methods">
      <h3>Forma de Pagamento</h3>
      <div id="payment-bricks-container"></div>
    </div>
    <div class="payment-status">
      <h3>Status do Pagamento</h3>
      <p id="payment-status">Aguardando pagamento...</p>
    </div>
  </section>

  <!-- Rodapé -->
  <footer>
    <div class="social-links">
      <a href="https://www.instagram.com" target="_blank">
        <img src="/img/instagram.png" alt="Ícone do Instagram" onerror="this.src='https://via.placeholder.com/24?text=IG';">
      </a>
      <a href="https://www.facebook.com" target="_blank">
        <img src="/img/facebook.png" alt="Ícone do Facebook" onerror="this.src='https://via.placeholder.com/24?text=FB';">
      </a>
    </div>
    <div class="payment-methods-footer">
      <h4>Formas de Pagamento</h4>
      <img src="/img/visa.png" alt="Visa" height="30">
      <img src="/img/mastercard.png" alt="Mastercard" height="30">
      <img src="/img/elo.png" alt="Elo" height="30">
      <img src="/img/amex.png" alt="Amex" height="30">
      <img src="/img/boleto.png" alt="Boleto" height="30">
      <img src="/img/pix.png" alt="Pix" class="pix-icon" height="40">
    </div>
    <div class="scroll-to-top">
      <div class="circle">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
        </svg>
      </div>
      <p>voltar ao topo</p>
    </div>
    <div class="footer-info">
      <p>Política de Privacidade | Termos de Uso</p>
      <p>Todos os direitos reservados © 2025 | SAVI COSMÉTICOS LTDA | CNPJ: 42.422.967/0001-01</p>
    </div>
  </footer>

  <script>
    // Dados padrão dos produtos (sincronizados com admin.html)
    const defaultProducts = [
      {
        id: "onetouch",
        name: "One Touch Silk Desodorante Colônia 100ml - Wepink",
        description: "exale delicadeza e doçura com um toque que encanta",
        fullDescription: "Sinta um toque delicado de carinho com o Desodorante Colônia Wepink One Touch Silk, um aroma alegre que revive a essência de um romance. Sua fragrância Floral e Frutada inicia no charme da Bergamota e no frescor do Morango, evoluindo em um coração floral encantador. Finaliza em um fundo doce e suave de Baunilha, florescendo a essência feminina inesquecível.",
        notes: "Notas de topo: Bergamota e Morango<br>Notas de coração: Floral<br>Notas de fundo: Baunilha",
        priceOld: 1000.00,
        priceNew: 350.00,
        installmentsPerUnit: 58.33,
        image: "/img/onetouch.png",
        deliveryFees: {
          sp: { option1: 3.00, option2: 4.00 },
          southeast: { option1: 5.00, option2: 6.00 },
          other: { option1: 7.00, option2: 8.00 }
        }
      },
      {
        id: "liberte",
        name: "Liberté Desodorante Colônia 100ml - Wepink",
        description: "Transborde a sua essência mais nobre.",
        fullDescription: "Liberté Desodorante Colônia Wepink é uma fragrância que reflete liberdade e sofisticação. Com notas florais orientais, inicia com um toque cítrico de Mandarina e Pêra, evoluindo para um coração de Jasmim e Flor de Laranjeira, e finalizando com um fundo quente de Âmbar e Baunilha, criando uma essência marcante e inesquecível.",
        notes: "Notas de topo: Mandarina e Pêra<br>Notas de coração: Jasmim e Flor de Laranjeira<br>Notas de fundo: Âmbar e Baunilha",
        priceOld: 329.00,
        priceNew: 115.15,
        installmentsPerUnit: 19.19,
        image: "/img/liberte.png",
        deliveryFees: {
          sp: { option1: 3.00, option2: 4.00 },
          southeast: { option1: 5.00, option2: 6.00 },
          other: { option1: 7.00, option2: 8.00 }
        }
      },
      {
        id: "golden",
        name: "VF Golden Desodorante Colônia 75ml - Wepink",
        description: "Fragrância preciosa que transforma momentos em ouro.",
        fullDescription: "VF Golden Desodorante Colônia Wepink é uma fragrância que evoca luxo e sofisticação. Com um caminho olfativo Âmbar Floral, inicia com notas de Pêssego e Maçã, passa por um coração floral de Rosa e Jasmim, e finaliza com um fundo rico de Âmbar e Sândalo, transformando cada momento em uma experiência dourada.",
        notes: "Notas de topo: Pêssego e Maçã<br>Notas de coração: Rosa e Jasmim<br>Notas de fundo: Âmbar e Sândalo",
        priceOld: 329.00,
        priceNew: 115.15,
        installmentsPerUnit: 19.19,
        image: "/img/golden.png",
        deliveryFees: {
          sp: { option1: 3.00, option2: 4.00 },
          southeast: { option1: 5.00, option2: 6.00 },
          other: { option1: 7.00, option2: 8.00 }
        }
      },
      {
        id: "obsessed",
        name: "Obsessed Desodorante Colônia 100ml - Wepink",
        description: "A elegância do mistério em uma essência única.",
        fullDescription: "Obsessed Desodorante Colônia Wepink é uma fragrância que captura o mistério e a elegância. Com um caminho olfativo Oriental Amadeirado, inicia com notas de Cardamomo e Pimenta Rosa, evolui para um coração de Lavanda e Gerânio, e finaliza com um fundo profundo de Patchouli e Âmbar, criando uma essência envolvente e inesquecível.",
        notes: "Notas de topo: Cardamomo e Pimenta Rosa<br>Notas de coração: Lavanda e Gerânio<br>Notas de fundo: Patchouli e Âmbar",
        priceOld: 329.00,
        priceNew: 115.15,
        installmentsPerUnit: 19.19,
        image: "/img/obsessed.png",
        deliveryFees: {
          sp: { option1: 3.00, option2: 4.00 },
          southeast: { option1: 5.00, option2: 6.00 },
          other: { option1: 7.00, option2: 8.00 }
        }
      },
      {
        id: "vf",
        name: "VF Bloom Desodorante Colônia 75ml - Wepink",
        description: "Beleza no sutil florescer do aroma.",
        fullDescription: "VF Bloom Desodorante Colônia Wepink é uma fragrância que celebra a beleza do florescer. Com um caminho olfativo Floral Cítrico, inicia com notas frescas de Limão Siciliano e Laranja, evolui para um coração de Peônia e Lírio, e finaliza com um fundo suave de Almíscar e Cedro, trazendo frescor e delicadeza a cada aplicação.",
        notes: "Notas de topo: Limão Siciliano e Laranja<br>Notas de coração: Peônia e Lírio<br>Notas de fundo: Almíscar e Cedro",
        priceOld: 329.00,
        priceNew: 115.15,
        installmentsPerUnit: 19.19,
        image: "/img/vf.png",
        deliveryFees: {
          sp: { option1: 3.00, option2: 4.00 },
          southeast: { option1: 5.00, option2: 6.00 },
          other: { option1: 7.00, option2: 8.00 }
        }
      },
      {
        id: "seduce",
        name: "VF Seduce Desodorante Colônia 75ml - Wepink",
        description: "Aura de magnetismo e sedução envolvente.",
        fullDescription: "VF Seduce Desodorante Colônia Wepink é uma fragrância que exala magnetismo e sedução. Com um caminho olfativo Floral Gourmand, inicia com notas doces de Caramelo e Framboesa, evolui para um coração de Rosa e Violeta, e finaliza com um fundo quente de Baunilha e Tonka, criando uma aura irresistível.",
        notes: "Notas de topo: Caramelo e Framboesa<br>Notas de coração: Rosa e Violeta<br>Notas de fundo: Baunilha e Tonka",
        priceOld: 329.00,
        priceNew: 115.15,
        installmentsPerUnit: 19.19,
        image: "/img/seduce.png",
        deliveryFees: {
          sp: { option1: 3.00, option2: 4.00 },
          southeast: { option1: 5.00, option2: 6.00 },
          other: { option1: 7.00, option2: 8.00 }
        }
      },
      {
        id: "therainy",
        name: "The Rainy Desodorante Colônia 75ml - Wepink",
        description: "Mergulhe na essência refrescante da natureza!",
        fullDescription: "The Rainy Desodorante Colônia Wepink traz a essência refrescante da natureza. Com um caminho olfativo Cítrico Aquático, inicia com notas de Limão e Notas Aquáticas, evolui para um coração de Menta e Jasmim, e finaliza com um fundo de Almíscar e Madeiras Brancas, trazendo uma sensação de frescor e serenidade.",
        notes: "Notas de topo: Limão e Notas Aquáticas<br>Notas de coração: Menta e Jasmim<br>Notas de fundo: Almíscar e Madeiras Brancas",
        priceOld: 329.00,
        priceNew: 115.15,
        installmentsPerUnit: 19.19,
        image: "/img/therainy.png",
        deliveryFees: {
          sp: { option1: 3.00, option2: 4.00 },
          southeast: { option1: 5.00, option2: 6.00 },
          other: { option1: 7.00, option2: 8.00 }
        }
      },
      {
        id: "celebrate",
        name: "Celebrate Life Desodorante Colônia 100ml - Wepink",
        description: "Comemore a vida com um aroma extraordinário.",
        fullDescription: "Celebrate Life Desodorante Colônia Wepink é uma fragrância que celebra a alegria de viver. Com um caminho olfativo Frutado Gourmand, inicia com notas de Maçã e Cassis, evolui para um coração de Praliné e Jasmim, e finaliza com um fundo doce de Baunilha e Caramelo, trazendo uma explosão de felicidade em cada borrifada.",
        notes: "Notas de topo: Maçã e Cassis<br>Notas de coração: Praliné e Jasmim<br>Notas de fundo: Baunilha e Caramelo",
        priceOld: 329.00,
        priceNew: 115.15,
        installmentsPerUnit: 19.19,
        image: "/img/celebrate.png",
        deliveryFees: {
          sp: { option1: 3.00, option2: 4.00 },
          southeast: { option1: 5.00, option2: 6.00 },
          other: { option1: 7.00, option2: 8.00 }
        }
      }
    ];

    // Função para formatar valores monetários
    function formatCurrency(value) {
      return `R$ ${value.toFixed(2).replace('.', ',')}`;
    }

    // Função para carregar os detalhes do pedido
    async function loadOrderDetails() {
      const urlParams = new URLSearchParams(window.location.search);
      const productId = urlParams.get('product');
      let product = defaultProducts.find(p => p.id === productId);

      // Tenta carregar do localStorage
      try {
        const storedProducts = JSON.parse(localStorage.getItem('wepink_products'));
        if (storedProducts && Array.isArray(storedProducts)) {
          const storedProduct = storedProducts.find(p => p.id === productId);
          if (storedProduct) product = storedProduct;
        }
      } catch (error) {
        console.error('Erro ao carregar produtos do localStorage:', error);
      }

      if (product) {
        document.getElementById('product-image').src = product.image;
        document.getElementById('product-name').innerText = product.name;
        document.getElementById('product-price').innerText = formatCurrency(product.priceNew);
        document.getElementById('subtotal').innerText = formatCurrency(product.priceNew);
        document.getElementById('total').innerText = formatCurrency(product.priceNew + product.deliveryFees.sp.option1);

        // Configurar Mercado Pago
        const mp = new MercadoPago('APP_USR-44c96b6c-33f1-49e4-9f9c-95dbe0338c2d', { locale: 'pt-BR' });
        const backendUrl = '/create-payment'; // Ajustado para o Render (relativo ao mesmo domínio)

        const bricks = mp.bricks();
        const renderPaymentBrick = async (bricks) => {
          const settings = {
            initialization: {
              amount: product.priceNew + product.deliveryFees.sp.option1, // Valor total
              payer: {
                email: "test_user@example.com",
              },
            },
            customization: {
              visual: {
                style: {
                  theme: "default",
                },
              },
            },
            callbacks: {
              onReady: () => {
                console.log("Payment Brick ready!");
              },
              onSubmit: ({ paymentType, formData }) => {
                return new Promise((resolve, reject) => {
                  fetch(backendUrl, {
                    method: "POST",
                    headers: {
                      "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                      transaction_amount: product.priceNew + product.deliveryFees.sp.option1,
                      description: product.name,
                      payment_method_id: formData.payment_method_id,
                      payer: {
                        email: formData.payer.email,
                      },
                    }),
                  })
                    .then((response) => response.json())
                    .then((response) => {
                      if (response.id) {
                        resolve();
                        checkPaymentStatus(response.id);
                      } else {
                        reject();
                      }
                    })
                    .catch((error) => {
                      console.error("Erro ao processar pagamento:", error);
                      reject();
                    });
                });
              },
              onError: (error) => {
                console.error("Erro no Payment Brick:", error);
              },
            },
          };
          window.paymentBrickController = await bricks.create("payment", "payment-bricks-container", settings);
        };
        renderPaymentBrick(bricks);

        // Função para verificar o status do pagamento
        async function checkPaymentStatus(paymentId) {
          const statusUrl = `/payment-status/${paymentId}`;
          try {
            const response = await fetch(statusUrl);
            const data = await response.json();
            const statusElement = document.getElementById('payment-status');
            if (data.status === 'approved') {
              statusElement.innerText = 'Pagamento Aprovado! Redirecionando...';
              setTimeout(() => {
                window.location.href = 'index.html';
              }, 2000);
            } else if (data.status === 'rejected') {
              statusElement.innerText = 'Pagamento Rejeitado. Tente novamente.';
            } else {
              statusElement.innerText = 'Pagamento Pendente...';
              setTimeout(() => checkPaymentStatus(paymentId), 5000);
            }
          } catch (error) {
            console.error("Erro ao verificar status do pagamento:", error);
            document.getElementById('payment-status').innerText = 'Erro ao verificar status. Tente novamente.';
          }
        }
      } else {
        document.querySelector('.payment-section').innerHTML = '<p>Produto não encontrado.</p>';
      }
    }

    // Carregar os detalhes do pedido ao iniciar a página
    loadOrderDetails();

    // Função para rolar ao topo
    document.querySelector('.scroll-to-top').addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  </script>
</body>
</html>
